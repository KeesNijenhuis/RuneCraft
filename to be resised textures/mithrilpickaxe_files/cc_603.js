(function(){var n="0.1.34",t,e="undefined",a=25,r=parseInt(1e3/a),o=t,i={"function":!0,object:!0},s={DEBUG_MODE:!1,counterID:"603",instanceID:"externalConf###Instanceid"},u=function(n){return typeof n!==e},c="HISTATS_CANVAS_DEBUG_ON";s.DEBUG_MODE=u(window[c])&&1==window[c];var l=function(){return s.instanceID},f="_HistatsCounterGraphics_",d,v=function(){return f+s.counterID},h=function(n){return!("string"!=typeof n||""==n)},p=function(){try{s.DEBUG_MODE&&u(console)&&console.log.apply(this,arguments)}catch(n){}},b=function(e,a){var i=e||{};try{var c=function(n){var t="autostart";return"undefined"!=typeof n[t]&&n[t]===!0},l={ANIMATION_RUNNING_STATUS:!0,ANIMATION_STARTED:!1,AUTOSTART:c(i),_STOPPED:!1,INSTANCE_ID:"-"+parseInt(1e4*Math.random())},f=function(){return l.INSTANCE_ID},h=100,b=1,w=function(){return a.document},m=function(n){return u(n)&&!!w().getElementById(n)},g=function(n){o=a.setTimeout(n,r)},T=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.msRequestAnimationFrame||a.oRequestAnimationFrame||g,A=a["Date"]||{},_=function(n,t){for(var e in n)t.hasOwnProperty(e)&&(t[e]=n[e])};i.getInstanceID=f;var x=v();i.IS_HISTATS_CANVAS=!0,i.globalObjectName=x,i.$window=a;var C=function(n){return m(n)?w().getElementById(n):t},S={w:0,h:0,yBase:0,xBase:0,hasShadow:!1,hasLabel:!1,shadowOffsetX:2,shadowOffsetY:2,shadowBlur:1,doMouseOverOut:1},y={msLastFrameDrawn:0,msPerFrame:r,frameCounter:0,isInAnimationTransition:!1,animation_duration_inFrames:20,waitframesBetweenTwoAnimations:80,framesBetweenTwoAnimations:100,currentLoopFrame:0,autoTriggerTextChange_onFrame:t,customization:{}},I={domCanvasObject:null,canvas2dContext:null,canvasProperties:S},B=function(){var n={},e=n.hasOwnProperty,a=0,r=0,o={blockMessages:!1,recordMessages:!1,messageLog:[],printMessages:!1,messagePassedCount:0,subscribersCount:0,topicsCount:0,_topics:n},i=function(t){return e.call(n,t)},s=function(t){return o.printMessages&&console.log(f(),"addTopic",t),r++,o.topicsCount++,r>50&&p(f(),"Lot of topics registered!",t),n[t]=[]},u=function(t){return n[t]},c=function(t,e,r){o.printMessages&&console.log(f(),"subscribe",t,e,r),o.recordMessages&&o.messageLog.push(["subscribe",t,e,r]),r=r||h,i(t)||s(t);var c=u(t).push({callback:e,priority:e})-1;return a++,o.subscribersCount++,a>50&&p(f(),"Lot of topics registered!",t),{remove:function(){delete n[t][c]}}},l=function(n,t){var e="no-topic-found";n!=e&&d(e,{topic:n,info:t})},d=function(e,a){return o.messagePassedCount++,o.printMessages&&console.log(f(),"publish",e,a),o.recordMessages&&o.messageLog.push(["publish",e,a]),o.blockMessages?void 0:i(e)?(n[e].slice().sort(function(n,t){return n.priority-t.priority}).forEach(function(n){n.callback(a!=t?a:{})}),void 0):(l(e,a),void 0)},v=function(n,t){T(function(){d(n,t)})};return{subscribe:c,publish:d,publishAsync:v,debugObj:o}}(),N=function(){return s.counterID},O=function(){var n="siteId";return i[n]=i[n]||0},P=function(){var n="main_div_name";return i[n]||"histats_counter_"+O()+"_"+N()},E=[],F=function(){return d=P(),d},k=function(){return F()+"_canvas"},D=function(){return"http://www.histats.com/viewstats/?sid="+O()+"&ccid="+N()},M=function(){a.location=D()},R=function(){if(1==I.canvasProperties.doMouseOverOut){var n=Q().canvasProperties;n.yBase=2,n.xBase=2,n.shadowOffsetX=0,n.shadowOffsetY=0}Q().domCanvasObject.style.cursor="pointer"},U=function(){if(1==I.canvasProperties.doMouseOverOut){var n=Q().canvasProperties;n.yBase=0,n.xBase=0,n.shadowOffsetX=2,n.shadowOffsetY=2}},L=function(){var n=Q(),t=n.canvasProperties,e=n.canvas2dContext;e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.shadowBlur=t.shadowBlur,e.shadowColor="rgba(0,0,0,0.2)"},V=function(){return C(F())},G=function(){var n=!!V();return n},j=function(){try{if(!G())return B.publish("error",{msg:"validateDomcontainer not found"}),void 0;var n=V(),t=Q().canvasProperties,e='<canvas id="'+k()+'" width="'+t.w+'" height="'+t.h+'" ></canvas>',r='<a href="'+D()+'" target="_blank">'+e+"</a>";n.innerHTML=r,Q().domCanvasObject=C(k());var o=Q().domCanvasObject;Q().canvas2dContext=o.getContext("2d"),"addEventListener"in a?(o.addEventListener("mouseover",function(){R()}),o.addEventListener("mouseout",function(){U()})):o.onclick=function(){M()}}catch(i){p(f(),"drawCanvas",i)}},q=function(){try{if(l.ANIMATION_STARTED)return;if(l._STOPPED)return;B.publish("draw-callback-requested-reconfiguration",{}),B.publish("starting_pre",{context:i}),l.ANIMATION_STARTED=!0,B.publish("started",{context:i}),B.publish("drawcanvas_pre",{context:i}),j(),B.publish("drawcanvas_post",{context:i}),J(),B.publish("animationLoop_started",{context:i})}catch(n){p(f(),"startNow",n,n.message)}},H=function(n,t,e){t.addEventListener?t.addEventListener(n,e,!1):t.attachEvent?t.attachEvent("on"+n,e):t[n]=e},X=function(){try{B.publish("appendedStart",{context:i,type:"animFrame"}),T(q)}catch(n){p(f(),"startAsap",n.message,n)}},Y=function(n,t){E.push({name:n,callback:t})},$=function(){},W=function(){E.forEach(function(n){n.callback(i.getCanvas2dContext(),y,Q())})},z=function(){u(o)&&a.clearTimeout(o)},J=function(){l._STOPPED||T(function(){tn(W),l.ANIMATION_RUNNING_STATUS&&J()})};B.subscribe("setAnimationProperties",function(n){_(n,y)}),B.subscribe("draw-callback-publish-reconfiguration",function(n){try{n.canvasCallbacks.forEach(function(n){E.push({name:n.name,callback:n.cb,priority:n.priority})}),E=E.slice().sort(function(n,t){return n.priority-t.priority})}catch(t){p(f(),"animationLoop",t.message,t)}}),B.subscribe("configuration-changed",function(n){E=[],B.publish("draw-callback-requested-reconfiguration",{})});var K=function(n){var t=n!=l.ANIMATION_RUNNING_STATUS;return t&&(0==l.ANIMATION_RUNNING_STATUS&&1==n,1==l.ANIMATION_RUNNING_STATUS&&0==n&&z(),l.ANIMATION_RUNNING_STATUS=n),t},Q=function(){return I},Z=function(){var n=!1;0==y.frameCounter&&B.publish("FIRST-FRAME",{});var t=A.now(),e=t-y.msLastFrameDrawn;if(e>y.msPerFrame){var a=e%y.msPerFrame;y.msLastFrameDrawn=t-a,n=!0}return n},nn=function(){if(!(y.animation_duration_inFrames<1)){var n=y.animation_duration_inFrames+y.waitframesBetweenTwoAnimations;y.currentLoopFrame=y.frameCounter%n;var t=0==y.currentLoopFrame,e=y.currentLoopFrame>=y.animation_duration_inFrames;t&&(y.isInAnimationTransition=!0,B.publish("drawing-triggered-animation-start",y)),e&&y.isInAnimationTransition&&(y.isInAnimationTransition=!1,B.publish("drawing-triggered-animation-end",y))}},tn=function(n){var t=Z();t&&(y.frameCounter++,nn(),n())},en=function(n){return n(i.getCanvas2dContext())},an=function(){var n=17,t=2,e=1,a=Q().canvasProperties,r=0;a.hasShadow&&(r=r+t+e),a.hasLabel&&(a.h=a.h+n),a.w=a.w+r,a.h=a.h+r},rn=function(n){_(n,Q().canvasProperties),an()};B.subscribe("setCanvasProperties",rn,10);var on=function(){i.onCanvas2dContext(function(n){var t=Q().canvasProperties;n.clearRect(0,0,t.w,t.h),t.hasShadow&&L()})};B.subscribe("clear-canvas-rectangle",on,10);var sn=function(n,t){Q().hasShadow&&(n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.shadowColor="transparent")},un=function(n,e){e.autoTriggerTextChange_onFrame!==t&&e.currentLoopFrame==e.autoTriggerTextChange_onFrame&&B.publish("drawing-change-text",{})},cn=function(n){B.publish("draw-callback-publish-reconfiguration",{canvasCallbacks:[{cb:sn,priority:14,name:"stopApplyingShadowOnCanvas"},{cb:un,priority:5,name:"autoUpdateText"}]})};B.subscribe("draw-callback-requested-reconfiguration",cn,15),i.__CODE_VERSION=n,i.getCanvasObject=Q,i.getCanvas2dContext=function(){return Q().canvas2dContext},i.onCanvas2dContext=en,i.getXYCanvas=function(){return{x:Q().canvasProperties.xBase,y:Q().canvasProperties.yBase}},i.addDrawCallback=Y,i.getCanvasProperties=function(){return Q().canvasProperties},i.setCanvasProperties=function(n){for(var t in n)n.hasOwnProperty(t)&&(I.canvasProperties[t]=n[t])},i.updateCanvasProperties=function(n){i.setCanvasProperties(n(Q().canvasProperties))},i.getAnimationFrames=function(){return y.frameCounter},i.getAnimationControl=function(){return y},i.setAnimationControl=function(n){for(var t in n)n.hasOwnProperty(t)&&(y[t]=n[t])},i.start=X,i.changeRunningStatus=K,i.getRunningStatus=function(){return l.ANIMATION_RUNNING_STATUS},i.eventBus=B,i.getDebugMode=function(){return s.DEBUG_MODE},function(){var n=this;n.IS_HISTATS_CANVAS||(n={});var e=n.statsText={},a={xBase:0,yBase:0},r=function(){return a},o=function(){var t=n.getXYCanvas();return a.xBase=t.x,a.yBase=t.y,a},i=[],s={stats_values:[],indexStatToShow:0,drawValueCallback:t,drawValueCallbackWithValue:t,drawMetricCallback:t},u=25,c=0,l=function(){return c%u==1},f=function(n){i=n};n.eventBus.subscribe("set-textbox-style",function(t){i=t,n.eventBus.publish("configuration-changed",{})}),n.eventBus.subscribe("canvas-drawValueFunction",function(n){"undefined"!=typeof n["transformationFunction"]&&(s.drawValueCallback=n["transformationFunction"])});function d(n,t,e,a){n=(n+"").replace(/[^0-9+\-Ee.]/g,"");var r=isFinite(+n)?+n:0,o=isFinite(+t)?Math.abs(t):0,i="undefined"==typeof a?",":a,s="undefined"==typeof e?".":e,u="",c=function(n,t){var e=Math.pow(10,t);return""+(Math.round(n*e)/e).toFixed(t)};return u=(o?c(r,o):""+Math.round(r)).split("."),u[0].length>3&&(u[0]=u[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(u[1]||"").length<o&&(u[1]=u[1]||"",u[1]+=new Array(o-u[1].length+1).join("0")),u.join(s)}var v=function(e){if(s.stats_values=e,s.drawValueCallback!=t){var a=e[0].value;s.drawValueCallbackWithValue=s.drawValueCallback(a)}n.eventBus.publish("configuration-changed",{})},h=function(){return s.stats_values},p=function(n){if(n===s.stats_values)return!1;if(typeof n==typeof[])for(var t in n)if(n.hasOwnProperty(t)&&typeof n[t]!=typeof{})return!1;return!0},b=function(){return n.globalObjectName+"_setValues"},w=function(){if(l()){var t=b();if("undefined"!=typeof n.$window&&"undefined"!=typeof n.$window[t]){var e=n.$window[t];p(e)&&v(e)}}},m=function(n){return(""+n).match(/^\s*[0-9]+\s*$/)?d(n,0,""," "):n},g=function(t,e){return function(a){a.shadowColor="transparent",a.font=t.name.font,a.textAlign=t.name.align,a.fillStyle=t.name.color,a.fillText(e.name,t.name.x+r().xBase,t.name.y+r().yBase),a.font=t.value.font,a.textAlign=t.value.align,a.fillStyle=t.value.color;var o=e.value;try{o=m(e.value)}catch(i){n.debug(i)}a.fillText(o,t.value.x+r().xBase,t.value.y+r().yBase)}},T=function(){s.indexStatToShow+=i.length,s.indexStatToShow>=s.stats_values.length&&(s.indexStatToShow=0)},A=!1;n.eventBus.subscribe("draw-hideText",function(n){A=!0},11),n.eventBus.subscribe("draw-unHideText",function(n){A=!1},11);var _=function(n){if(!A){var t,e,a=s.indexStatToShow,r=h(),o=r.length;r.length>i.length&&(o=i.length);for(var u=0;o>u&&(a>=r.length&&(a=0),r[a]);u++)t=i[u],e=r[a],g(t,e)(n),a++}},x=function(n,e){return c++,w(),o(),s.drawValueCallbackWithValue!=t?(s.drawValueCallbackWithValue(n),void 0):(_(n),void 0)},C=function(t){n.eventBus.publish("draw-callback-publish-reconfiguration",{canvasCallbacks:[{cb:x,priority:15,name:"show_stats_draw"}]})};n.eventBus.subscribe("draw-callback-requested-reconfiguration",C,11);var S=n.eventBus.subscribe("drawing-change-text",T,10);e.draw=x,e.setBoxes=f,e.setValues=v}.call(i),function(){var n=this;n.IS_HISTATS_CANVAS||(n={});var t={x:0,y:0,w:0,h:2,xStart:0,xEnd:0,color:"#ffffff",pixelPerFrame:0},e=function(n,e){var a=Q().canvasProperties,r=0;a.hasShadow&&(r=3),t.color=e.color,t.y=a.h-t.h,t.w=a.w,t.xStart=-1*a.w,t.xEnd=a.w,t.pixelPerFrame=(t.xEnd-t.xStart)/n.waitframesBetweenTwoAnimations};n.eventBus.subscribe("set-line-params",function(t){e(y,t),n.eventBus.publish("configuration-changed",{})});var a=function(n,e){t.x+=t.pixelPerFrame,n.fillStyle=t.color,n.fillRect(t.x,t.y,t.w,t.h)},r=function(n,e){e.isInAnimationTransition?t.x=t.xStart:a(n,e)},o=function(t){n.eventBus.publish("draw-callback-publish-reconfiguration",{canvasCallbacks:[{cb:r,priority:20,name:"start"}]})};n.eventBus.subscribe("draw-callback-requested-reconfiguration",o,11)}.call(i),function(){var n=this;n.IS_HISTATS_CANVAS||(n={});var t=n.counter={};t.ID="603",t.properties={w:110,h:40,hasShadow:!0};var e={animation_duration_inFrames:20,autoTriggerTextChange_onFrame:20,waitframesBetweenTwoAnimations:80},a={color:"#000000"},r=[{name:{x:2,y:15,align:"left",color:"#000000",font:"11px Arial"},value:{x:107,y:15,align:"right",color:"#000000",font:"11px Arial"}},{name:{x:2,y:33,align:"left",color:"#000000",font:"11px Arial"},value:{x:107,y:33,align:"right",color:"#000000",font:"11px Arial"}}];n.eventBus.publish("set-textbox-style",r),n.eventBus.publish("setCanvasProperties",t.properties),n.eventBus.publish("setAnimationProperties",e),n.eventBus.publish("set-line-params",a);var o=function(t,e){n.eventBus.publish("clear-canvas-rectangle",{})},i=function(t){n.eventBus.publish("draw-callback-publish-reconfiguration",{canvasCallbacks:[{cb:o,priority:10,name:"executeAnimationDuringShowValue"}]})};return n.eventBus.subscribe("draw-callback-requested-reconfiguration",i,13),n}.call(i),l.AUTOSTART&&i.start()}catch(ln){}return i},w="base.js",m=window,g="_DEBUG_HISTATSCANVAS_RETURN_BUILDER";_value_RETURN_BUILDER=u(window[g])&&window[g]===!0,window[v()]=b,window["histats_canvascounters_"+w]=b}).call(this);